<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Data visualisation | Intro to Data Visualisation Using R and the Slave Voyages dataset</title>
  <meta name="description" content="Chapter 2 Data visualisation | Intro to Data Visualisation Using R and the Slave Voyages dataset" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Data visualisation | Intro to Data Visualisation Using R and the Slave Voyages dataset" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Data visualisation | Intro to Data Visualisation Using R and the Slave Voyages dataset" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="include\psyteachr.css" type="text/css" />
<link rel="stylesheet" href="include\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro to Data Viz</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro</a></li>
<li class="chapter" data-level="2" data-path="data-visualisation.html"><a href="data-visualisation.html"><i class="fa fa-check"></i><b>2</b> Data visualisation</a><ul>
<li class="chapter" data-level="2.1" data-path="data-visualisation.html"><a href="data-visualisation.html#set-up"><i class="fa fa-check"></i><b>2.1</b> Set-up</a></li>
<li class="chapter" data-level="2.2" data-path="data-visualisation.html"><a href="data-visualisation.html#house-keeping"><i class="fa fa-check"></i><b>2.2</b> House-keeping</a></li>
<li class="chapter" data-level="2.3" data-path="data-visualisation.html"><a href="data-visualisation.html#making-plots-with-ggplot2"><i class="fa fa-check"></i><b>2.3</b> Making plots with <code>ggplot2</code></a></li>
<li class="chapter" data-level="2.4" data-path="data-visualisation.html"><a href="data-visualisation.html#additional-layers"><i class="fa fa-check"></i><b>2.4</b> Additional layers</a></li>
<li class="chapter" data-level="2.5" data-path="data-visualisation.html"><a href="data-visualisation.html#scatterplots"><i class="fa fa-check"></i><b>2.5</b> Scatterplots</a></li>
<li class="chapter" data-level="2.6" data-path="data-visualisation.html"><a href="data-visualisation.html#boxplots"><i class="fa fa-check"></i><b>2.6</b> Boxplots</a></li>
<li class="chapter" data-level="2.7" data-path="data-visualisation.html"><a href="data-visualisation.html#violin-boxplots"><i class="fa fa-check"></i><b>2.7</b> Violin-boxplots</a></li>
<li class="chapter" data-level="2.8" data-path="data-visualisation.html"><a href="data-visualisation.html#bar-charts"><i class="fa fa-check"></i><b>2.8</b> Bar charts</a></li>
<li class="chapter" data-level="2.9" data-path="data-visualisation.html"><a href="data-visualisation.html#plotting-summary-statistics"><i class="fa fa-check"></i><b>2.9</b> Plotting summary statistics</a></li>
<li class="chapter" data-level="2.10" data-path="data-visualisation.html"><a href="data-visualisation.html#saving-plots"><i class="fa fa-check"></i><b>2.10</b> Saving plots</a></li>
<li class="chapter" data-level="2.11" data-path="data-visualisation.html"><a href="data-visualisation.html#adding-more-variables"><i class="fa fa-check"></i><b>2.11</b> Adding more variables</a></li>
<li class="chapter" data-level="2.12" data-path="data-visualisation.html"><a href="data-visualisation.html#reshaping-data"><i class="fa fa-check"></i><b>2.12</b> Reshaping data</a></li>
<li class="chapter" data-level="2.13" data-path="data-visualisation.html"><a href="data-visualisation.html#grouping-data-with-fill"><i class="fa fa-check"></i><b>2.13</b> Grouping data with <code>fill</code></a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="divider"></li>
<li><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" 
    target="blank"><img alt="Creative Commons License" 
    style="border-width:0" 
    src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><li>
<li><a href="https://psyteachr.github.io/" target="blank">PsyTeachR</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to Data Visualisation Using R and the Slave Voyages dataset</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-visualisation" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Data visualisation</h1>
<div id="set-up" class="section level2">
<h2><span class="header-section-number">2.1</span> Set-up</h2>
<p>The <a href="https://www.slavevoyages.org/">Slave Voyages</a> website contains a huge amount of data. For this tutorial I will provide a specific subset but you can explore the dataset further and download your own version.</p>
<p>For the purpose of this tutorial, please download <a href="data.csv" download>this data</a> in order to replicate my analyses and output exactly. This data is a subset of all the available dataset, and focuses on slave ships that originated in Britain.</p>
<p>For this tutorial you will find it helpful to write your code in RMarkdown. Not only does Markdown make it easy to write additional notes alongside your code, but it’s easier to produce a document that looks good that you can share. If you need more information about Markdown and/or setting your working directory see <a href="https://psyteachr.github.io/msc-conv-odl/ref2.html">Intro to R</a></p>
<ul>
<li>Download the data, open RStudio and set your working directory to the folder the data is in, and open up a new Markdown document.</li>
</ul>
<p>The main package we’re going to use is the <code>tidyverse</code> collection. The <code>tidyverse</code> is a collection of packages that are frequently used for data wrangling and visualisation. The ones we will draw on most heavily in this tutorial are <code>dplyr</code> for wrangling and <code>ggplot2</code> for plotting.</p>
<ul>
<li>Load the <code>tidyverse</code> package</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-visualisation.html#cb1-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>Next we need to load the data that is stored in <code>data.csv</code>. For more info, see <a href="https://psyteachr.github.io/msc-conv-odl/loading-data.html">Loading Data</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-visualisation.html#cb2-1"></a>dat &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data.csv&quot;</span>)</span></code></pre></div>
<ul>
<li>The dataset has <input class='solveme nospaces' size='5' data-answer='["10507"]'/> rows of data and <input class='solveme nospaces' size='2' data-answer='["13"]'/> columns.</li>
</ul>
</div>
<div id="house-keeping" class="section level2">
<h2><span class="header-section-number">2.2</span> House-keeping</h2>
<p>Look at the data, either by clicking <code>dat</code> in the Environment pane or by running <code>dat</code> in the console, and familiarise yourself with what the data refer to - if you need additional explanation, consult the <a href="https://www.slavevoyages.org/">Slave Voyages</a> website. As you can see, the labels of the columns are quite long, which means they’re informative, but they’re not going to be easy to work with in R.</p>
<p>As a rule, you should avoid variable names that have spaces and you should pick a naming convention and stick with it. Popular choices are to use periods (<code>my.var</code>), letter case (<code>myVar</code>) or underscores (<code>my_var</code>). I prefer using underscores and never using a capital letter anywhere so that’s what we’ll do in this tutorial.</p>
<p>The first thing we’re going to do is to use <code>rename()</code> to make the variables easier to work with. This might seem a bit clunky but it will save us a huge amount of time in the future.</p>
<p>A few things to note:</p>
<ul>
<li>The syntax of <code>rename()</code> is <code>new_name = old_name</code>.</li>
<li>Because the original names have spaces, you need to enclose the old variable names in back-ticks.</li>
<li>Pick short names that make sense to you. If my names don’t seem informative, choose your own but you’ll need to remember what your equivalents are throughout this tutorial.</li>
<li>When writing code, if you press enter after a comma it should do a line break like the below code which can be easier to read.</li>
<li>Comments (with a #) are bits of text that R ignores when running the code, you can use them to leave notes to yourself</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-visualisation.html#cb3-1"></a>dat_rename &lt;-<span class="st"> </span><span class="kw">rename</span>(dat, <span class="co"># the name of the dataset you want to use</span></span>
<span id="cb3-2"><a href="data-visualisation.html#cb3-2"></a>              <span class="dt">id =</span> <span class="st">`</span><span class="dt">Voyage ID</span><span class="st">`</span>,</span>
<span id="cb3-3"><a href="data-visualisation.html#cb3-3"></a>              <span class="dt">vessel =</span> <span class="st">`</span><span class="dt">Vessel name</span><span class="st">`</span>,</span>
<span id="cb3-4"><a href="data-visualisation.html#cb3-4"></a>              <span class="dt">start_port =</span> <span class="st">`</span><span class="dt">Voyage itinerary imputed port where began (ptdepimp) place</span><span class="st">`</span>,</span>
<span id="cb3-5"><a href="data-visualisation.html#cb3-5"></a>              <span class="dt">purchase_place =</span> <span class="st">`</span><span class="dt">Voyage itinerary imputed principal place of slave purchase (mjbyptimp)</span><span class="st">`</span>,</span>
<span id="cb3-6"><a href="data-visualisation.html#cb3-6"></a>              <span class="dt">total_embarked =</span> <span class="st">`</span><span class="dt">Total embarked</span><span class="st">`</span>,</span>
<span id="cb3-7"><a href="data-visualisation.html#cb3-7"></a>              <span class="dt">total_disembarked =</span> <span class="st">`</span><span class="dt">Total disembarked</span><span class="st">`</span>,</span>
<span id="cb3-8"><a href="data-visualisation.html#cb3-8"></a>              <span class="dt">arrival_year =</span> <span class="st">`</span><span class="dt">Year of arrival at port of disembarkation</span><span class="st">`</span>,</span>
<span id="cb3-9"><a href="data-visualisation.html#cb3-9"></a>              <span class="dt">men =</span> <span class="st">`</span><span class="dt">Percent men</span><span class="st">`</span>,</span>
<span id="cb3-10"><a href="data-visualisation.html#cb3-10"></a>              <span class="dt">women =</span> <span class="st">`</span><span class="dt">Percent women</span><span class="st">`</span>,</span>
<span id="cb3-11"><a href="data-visualisation.html#cb3-11"></a>              <span class="dt">children =</span> <span class="st">`</span><span class="dt">Percent children</span><span class="st">`</span>,</span>
<span id="cb3-12"><a href="data-visualisation.html#cb3-12"></a>              <span class="dt">died =</span> <span class="st">`</span><span class="dt">Slaves died during middle passage</span><span class="st">`</span>,</span>
<span id="cb3-13"><a href="data-visualisation.html#cb3-13"></a>              <span class="dt">mortality =</span> <span class="st">`</span><span class="dt">Mortality rate</span><span class="st">`</span>,</span>
<span id="cb3-14"><a href="data-visualisation.html#cb3-14"></a>              <span class="dt">outcome =</span> <span class="st">`</span><span class="dt">Slaves outcome label</span><span class="st">`</span></span>
<span id="cb3-15"><a href="data-visualisation.html#cb3-15"></a>              )</span></code></pre></div>
<p>The final thing we need to do is check what type of data R thinks each column is. There’s a few ways you can do this, try each of the below options and view the output.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-visualisation.html#cb4-1"></a><span class="kw">str</span>(dat_rename)</span>
<span id="cb4-2"><a href="data-visualisation.html#cb4-2"></a><span class="kw">summary</span>(dat_rename)</span>
<span id="cb4-3"><a href="data-visualisation.html#cb4-3"></a><span class="kw">sapply</span>(dat_rename, class)</span></code></pre></div>
<ul>
<li>How many of the variables are character (i.e., text) variables? <input class='solveme nospaces' size='1' data-answer='["4"]'/></li>
<li>How many of the variables are numeric (otherwise known as double)? <input class='solveme nospaces' size='1' data-answer='["9"]'/></li>
</ul>
<p>A lot of these are correct, but there’s a few that might cause us issues further down the line. Whilst <code>id</code> contains numbers, the information in it isn’t numeric, they’re just simply names that happen to be in numerical format. Additionally, <code>character</code> doesn’t quite do justice to the data that’s contained in those columns because it’s not just any old text, it’s a fixed set of categories, or factors.</p>
<p>We’re going to transform the data using the function <code>mutate()</code>. <code>mutate()</code> can be used to create new columns, but it can also be used to overwrite existing columns if you use the same variable name on the left-hand side and right-hand side of the equal sign.</p>
<ul>
<li>You can read the below code as “overwrite the column <code>id</code> with <code>id</code> as a factor” and so on.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-visualisation.html#cb5-1"></a>dat_final &lt;-<span class="st"> </span><span class="kw">mutate</span>(dat_rename,</span>
<span id="cb5-2"><a href="data-visualisation.html#cb5-2"></a>                      <span class="dt">id =</span> <span class="kw">as.factor</span>(id),</span>
<span id="cb5-3"><a href="data-visualisation.html#cb5-3"></a>                      <span class="dt">vessel =</span> <span class="kw">as.factor</span>(vessel),</span>
<span id="cb5-4"><a href="data-visualisation.html#cb5-4"></a>                      <span class="dt">start_port =</span> <span class="kw">as.factor</span>(start_port),</span>
<span id="cb5-5"><a href="data-visualisation.html#cb5-5"></a>                      <span class="dt">purchase_place =</span> <span class="kw">as.factor</span>(purchase_place),</span>
<span id="cb5-6"><a href="data-visualisation.html#cb5-6"></a>                      <span class="dt">outcome =</span> <span class="kw">as.factor</span>(outcome))</span></code></pre></div>
<p>There is a quicker way to do this which you can <a href="https://dplyr.tidyverse.org/reference/across.html">read about here</a> if you’re feeling confident.</p>
<ul>
<li>Run <code>summary()</code> again on this new dataset and look at how the summary of the new factor variables has changed.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-visualisation.html#cb6-1"></a><span class="kw">summary</span>(dat_final)</span></code></pre></div>
</div>
<div id="making-plots-with-ggplot2" class="section level2">
<h2><span class="header-section-number">2.3</span> Making plots with <code>ggplot2</code></h2>
<p><code>ggplot</code> is so powerful because it uses layers and each layer can be customised independently from the others. The first layer is always the base of the plot that specifies the axes and any other grouping variables.</p>
<ul>
<li>Run the below code and look at the output.</li>
<li><code>aes</code> = aesthetics mappings</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-visualisation.html#cb7-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dat_final, <span class="kw">aes</span>(<span class="dt">x =</span> arrival_year, <span class="dt">y =</span> total_embarked))</span></code></pre></div>
<p>Given the type of variables, what type of plot is likely to be built on this base layer? <select class='solveme' data-answer='["Scatterplot"]'> <option></option> <option>Bar chart</option> <option>Scatterplot</option> <option>Histogram</option></select></p>
</div>
<div id="additional-layers" class="section level2">
<h2><span class="header-section-number">2.4</span> Additional layers</h2>
<p>Once you have specified the base layer of the plot, you can then add additional elements. Geoms are geometric objects and are the most common type of layer you will add. Geoms can be representations of the data (data points, bar charts, boxplots, histograms) or representations of variability in the data (error bars).</p>
</div>
<div id="scatterplots" class="section level2">
<h2><span class="header-section-number">2.5</span> Scatterplots</h2>
<p>Let’s complete the scatterplot above by plotting the raw data points using <code>geom_point()</code>.</p>
<p>Things to note:</p>
<ul>
<li>You don’t need to write the argument names (data, x, y) as long as you use them in the default order. When you’re first learning R, it can help to write them out.</li>
<li>R will give you the warning message <code>Removed 422 rows containing missing values (geom_point)</code>. This means that there were 422 rows in the data where one or both of the variables you’re trying to plot are missing.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-visualisation.html#cb8-1"></a><span class="kw">ggplot</span>(dat_final, <span class="kw">aes</span>(arrival_year, total_embarked)) <span class="op">+</span></span>
<span id="cb8-2"><a href="data-visualisation.html#cb8-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 422 rows containing missing values (geom_point).</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-8"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-8-1.png" alt="Basic scatterplot" width="100%" />
<p class="caption">
Figure 2.1: Basic scatterplot
</p>
</div>
<p>There’s so many data points that it makes it difficult to get a real sense of the spread of the data. This isn’t a fault of the graph, it’s because of how many people were enslaved.</p>
<p>To help identify any trends, it can be useful to add a line of best fit with an additional layer and an additional geom. <code>geom_smooth()</code> uses the <code>loess</code> method by default but if you’re fitting a linear model it can be better to adjust the default to <code>method = lm</code>.</p>
<ul>
<li>Try both options and decide which one best represents the trend of the data.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-visualisation.html#cb10-1"></a><span class="kw">ggplot</span>(dat_final, <span class="kw">aes</span>(arrival_year, total_embarked)) <span class="op">+</span></span>
<span id="cb10-2"><a href="data-visualisation.html#cb10-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb10-3"><a href="data-visualisation.html#cb10-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span>
<span id="cb10-4"><a href="data-visualisation.html#cb10-4"></a></span>
<span id="cb10-5"><a href="data-visualisation.html#cb10-5"></a><span class="kw">ggplot</span>(dat_final, <span class="kw">aes</span>(arrival_year, total_embarked)) <span class="op">+</span></span>
<span id="cb10-6"><a href="data-visualisation.html#cb10-6"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb10-7"><a href="data-visualisation.html#cb10-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p>One final note on layers before we move on, the order of the layers matters. If you specify <code>geom_smooth()</code> first, <code>ggplot()</code> will take your orders literally and draw the data points on top of it.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-visualisation.html#cb11-1"></a><span class="kw">ggplot</span>(dat_final, <span class="kw">aes</span>(arrival_year, total_embarked)) <span class="op">+</span></span>
<span id="cb11-2"><a href="data-visualisation.html#cb11-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb11-3"><a href="data-visualisation.html#cb11-3"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-10"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-10-1.png" alt="Badly ordered layers" width="100%" />
<p class="caption">
Figure 2.2: Badly ordered layers
</p>
</div>
</div>
<div id="boxplots" class="section level2">
<h2><span class="header-section-number">2.6</span> Boxplots</h2>
<p>Boxplots can be drawn using <code>geom_boxplot()</code> and require a categorical variable on the x-axis and a continuous variable on the y-axis.</p>
<ul>
<li>Run the below code. What’s the problem with this graph?</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-visualisation.html#cb12-1"></a><span class="kw">ggplot</span>(dat_final, <span class="kw">aes</span>(<span class="dt">x =</span> start_port, <span class="dt">y =</span> total_embarked)) <span class="op">+</span></span>
<span id="cb12-2"><a href="data-visualisation.html#cb12-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<p>There’s too many categories of the x-axis to sensibly display on a single graph. We already know this from the output of summary, but we can use <code>group_by()</code>, <code>count()</code>, and <code>arrange()</code> to give us a total of how many data points there are for each port.</p>
<ul>
<li><code>group_by()</code> doesn’t make any surface changes to your data, instead, it groups the data so that whatever operation comes next is performed for each group in the specified variable.</li>
<li>Try removing the <code>group_by()</code> line or changing <code>start_port</code> to another categorical variable to see how the output changes.</li>
<li>This code uses <code>%&gt;%</code> or <strong>pipes</strong>. Pipes send the output of a line of code to the first argument of the next line of code and are an extremely efficient way to write code. There is more information in the <a href="https://psyteachr.github.io/msc-conv-odl/data-wrangling-2.html#pipes">Data Wrangling chapter</a>.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-visualisation.html#cb13-1"></a>port_counts &lt;-<span class="st"> </span>dat_final <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># take dat_final</span></span>
<span id="cb13-2"><a href="data-visualisation.html#cb13-2"></a><span class="st">  </span><span class="kw">group_by</span>(start_port) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># then group it by start_port</span></span>
<span id="cb13-3"><a href="data-visualisation.html#cb13-3"></a><span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># then count how many observations in each group</span></span>
<span id="cb13-4"><a href="data-visualisation.html#cb13-4"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="co"># then arrange it in descending order</span></span></code></pre></div>
<p>Look at <code>port_counts</code>. As you can see, Liverpool, London, and Bristol have significantly more data points than any other location, so we will filter the dataset using <code>filter()</code> and just use these ports for the boxplot.</p>
<ul>
<li>This code uses the <code>%in%</code> notation. You can read this as “retain any observation where <code>start_port</code> is equal to one of these values”.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-visualisation.html#cb14-1"></a>dat_filter &lt;-<span class="st"> </span>dat_final <span class="op">%&gt;%</span></span>
<span id="cb14-2"><a href="data-visualisation.html#cb14-2"></a><span class="st">  </span><span class="kw">filter</span>(start_port <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Liverpool&quot;</span>, <span class="st">&quot;London&quot;</span>, <span class="st">&quot;Bristol&quot;</span>))</span></code></pre></div>
<p>Now we can run the boxplot again using the filtered dataset. We can see that the median number of slaves that embarked on each slave ship originating in Liverpool, London and Bristol was over 250 but that there are many cases where this number is much, much higher.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-visualisation.html#cb15-1"></a><span class="kw">ggplot</span>(dat_filter, <span class="kw">aes</span>(<span class="dt">x =</span> start_port, <span class="dt">y =</span> total_embarked)) <span class="op">+</span></span>
<span id="cb15-2"><a href="data-visualisation.html#cb15-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-14"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-14-1.png" alt="Simple boxplot" width="100%" />
<p class="caption">
Figure 2.3: Simple boxplot
</p>
</div>
</div>
<div id="violin-boxplots" class="section level2">
<h2><span class="header-section-number">2.7</span> Violin-boxplots</h2>
<p>R gives you a much greater range of visualisation options than those presented by proprietary software like SPSS or Excel. Using layers, you can add a violin plot on to a boxplot to show the distribution of the data using <code>geom_violin()</code></p>
<p>Things to note:</p>
<ul>
<li>The order of the layers is important, if you draw the boxplot then the violin on top of it, you won’t be able to see the boxplot.</li>
<li>Trying changing <code>trim = FALSE</code> to <code>TRUE</code>.</li>
<li>Try changing the value of <code>width = .2</code></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-visualisation.html#cb16-1"></a><span class="kw">ggplot</span>(dat_filter, <span class="kw">aes</span>(<span class="dt">x =</span> start_port, <span class="dt">y =</span> total_embarked)) <span class="op">+</span></span>
<span id="cb16-2"><a href="data-visualisation.html#cb16-2"></a><span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">trim =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb16-3"><a href="data-visualisation.html#cb16-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">width =</span> <span class="fl">.2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-15"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-15-1.png" alt="Violin-boxplot" width="100%" />
<p class="caption">
Figure 2.4: Violin-boxplot
</p>
</div>
<p>We can see from these plots that the median number of slaves that embarked <em>on each ship</em> was just over 250 but that in many cases this number was much, much higher, particularly for ships that originated in Liverpool.</p>
</div>
<div id="bar-charts" class="section level2">
<h2><span class="header-section-number">2.8</span> Bar charts</h2>
<p>Bar charts should only ever be used to represent counts rather than measures of central tendency like the mean because they hide so much variability. Each geom has a default statistic associated with it (for example, the line in the boxplots above was the median) and in keeping with this ethos, the default statistic for <code>geom_bar()</code> is a simple count.</p>
<p>Things to note:</p>
<ul>
<li>With <code>geom_bar()</code> you don’t need to specify the y-axis, because the y-axis is always going to be a count.</li>
<li>Try removing <code>fill = start_port</code> and see what happens.</li>
<li>Try changing <code>show.legend()</code> to <code>TRUE</code> and see what happens. Why do we want to suppress the legend in this case?</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-visualisation.html#cb17-1"></a><span class="kw">ggplot</span>(dat_filter, <span class="kw">aes</span>(<span class="dt">x =</span> start_port, <span class="dt">fill =</span> start_port)) <span class="op">+</span></span>
<span id="cb17-2"><a href="data-visualisation.html#cb17-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-16"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-16-1.png" alt="Bar chart of counts" width="100%" />
<p class="caption">
Figure 2.5: Bar chart of counts
</p>
</div>
<p>Remember, this graph does not show the total number of slaves on the ships from these ports, it merely shows the number of voyages that originated from these three ports.</p>
</div>
<div id="plotting-summary-statistics" class="section level2">
<h2><span class="header-section-number">2.9</span> Plotting summary statistics</h2>
<p>In the above plots, we have plotted the raw data. For the boxplots, R has done some calculations in the background to determine the medians and the IQR and the bar charts have counted the number of observations but we didn’t need to do anything extra. Often we will want to produce plots of summary statistics or aggregates.</p>
<p>To do this it is best to use <code>summarise()</code> to produce a summary table and then plot that data. We will follow on from the above and calculate the number of slaves, not just the number of voyages, that embarked on ships originating from these three British ports.</p>
<p>Things to note:</p>
<ul>
<li><code>group_by()</code> does the same as it did above. Try removing the <code>group_by()</code> line and running the code, what does it show instead?</li>
<li><code>na.rm = TRUE</code> means remove any NA (missing) values when calculating the summary statistic. If you don’t specify this and there are missing values, R won’t calculate your statistic. Sometimes this is what you want, sometimes it isn’t.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-visualisation.html#cb18-1"></a>port_summary &lt;-<span class="st"> </span>dat_filter <span class="op">%&gt;%</span></span>
<span id="cb18-2"><a href="data-visualisation.html#cb18-2"></a><span class="st">  </span><span class="kw">group_by</span>(start_port) <span class="op">%&gt;%</span></span>
<span id="cb18-3"><a href="data-visualisation.html#cb18-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">embarked =</span> <span class="kw">sum</span>(total_embarked, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p>Look at <code>port_summary</code>. How many slaves embarked on slave ships that originated in Liverpool? <select class='solveme' data-answer='["~1.3 million"]'> <option></option> <option>~832 thousand</option> <option>~1.3 million</option> <option>56 thousand</option></select></p>
<p>We can then use this summarised data to create another bar chart, however, this time, because we don’t need R to count up the values (we’ve already done it), we’re going to use <code>geom_col()</code> rather than <code>geom_bar()</code>. The default stat for <code>geom_col()</code> is “identity”, i.e., it just uses the exact numbers you give it rather than calculating anything.</p>
<p>Things to note:</p>
<ul>
<li>We now have to specify the y-axis, to tell <code>geom_col()</code> which column of numbers we want to represent on our plot.</li>
<li>We’ve added an extra layer that makes our fill colours colour-blind friendly (the viridis palette). Because our fill variable is discrete (categorical), we’ve used the <code>...viridis_d</code> option, if we had a continuous variable, there’s a <code>...viridis_c</code> version.</li>
<li>Try changing <code>option = "E"</code> to any letter from A - D and see which one you prefer.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-visualisation.html#cb19-1"></a><span class="kw">ggplot</span>(port_summary, <span class="kw">aes</span>(<span class="dt">x =</span> start_port, <span class="dt">y =</span> embarked, <span class="dt">fill =</span> start_port)) <span class="op">+</span></span>
<span id="cb19-2"><a href="data-visualisation.html#cb19-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb19-3"><a href="data-visualisation.html#cb19-3"></a><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;E&quot;</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-18"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-18-1.png" alt="Bar chart of summarised data with colour-blind palette" width="100%" />
<p class="caption">
Figure 2.6: Bar chart of summarised data with colour-blind palette
</p>
</div>
<p>There were so many slaves embarked on ships originating from these three ports that R has decided that it is better to use scientific notation for the y-axis values. Try and think about the last time you had any data where the numbers involved were this large.</p>
<p>To override this behaviour and make the plot more readable we need to add an extra argument to adjust the y-axis labels.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-visualisation.html#cb20-1"></a><span class="kw">ggplot</span>(port_summary, <span class="kw">aes</span>(<span class="dt">x =</span> start_port, <span class="dt">y =</span> embarked, <span class="dt">fill =</span> start_port)) <span class="op">+</span></span>
<span id="cb20-2"><a href="data-visualisation.html#cb20-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb20-3"><a href="data-visualisation.html#cb20-3"></a><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;E&quot;</span>) <span class="op">+</span></span>
<span id="cb20-4"><a href="data-visualisation.html#cb20-4"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-19"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-19-1.png" alt="Bar chart with adjusted y-axis labels" width="100%" />
<p class="caption">
Figure 2.7: Bar chart with adjusted y-axis labels
</p>
</div>
<p>Let’s make some further visual adjustments:</p>
<ul>
<li><code>labs()</code> controls the labels of the axes.</li>
<li>You can adjust the overall theme of the graph using the theme functions. Here I have used <code>theme_minimal()</code> but there are lots of others available. Try deleting the line of code and then type <code>theme_</code> and see all of the options that come up on the auto-complete suggestions. Try them out to find one you like.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data-visualisation.html#cb21-1"></a><span class="kw">ggplot</span>(port_summary, <span class="kw">aes</span>(<span class="dt">x =</span> start_port, <span class="dt">y =</span> embarked, <span class="dt">fill =</span> start_port)) <span class="op">+</span></span>
<span id="cb21-2"><a href="data-visualisation.html#cb21-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb21-3"><a href="data-visualisation.html#cb21-3"></a><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;E&quot;</span>) <span class="op">+</span></span>
<span id="cb21-4"><a href="data-visualisation.html#cb21-4"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb21-5"><a href="data-visualisation.html#cb21-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Port ship originated from&quot;</span>, </span>
<span id="cb21-6"><a href="data-visualisation.html#cb21-6"></a>       <span class="dt">y =</span> <span class="st">&quot;Number of slaves embarked&quot;</span>,</span>
<span id="cb21-7"><a href="data-visualisation.html#cb21-7"></a>       <span class="dt">title =</span> <span class="st">&quot;Slaves embarked on ships originating in British ports&quot;</span>) <span class="op">+</span></span>
<span id="cb21-8"><a href="data-visualisation.html#cb21-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-20"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-20-1.png" alt="Bar chart with theme and title" width="100%" />
<p class="caption">
Figure 2.8: Bar chart with theme and title
</p>
</div>
</div>
<div id="saving-plots" class="section level2">
<h2><span class="header-section-number">2.10</span> Saving plots</h2>
<p>The <code>ggsave()</code> function makes it easy to save your plots. By default, R will save your plots to the main folder of your working directory unless you tell it otherwise.</p>
<p>The only argument you must provide to <code>ggsave()</code> is the name of the file you wish to create, with an image file extension. You can choose to save your image as “eps”, “ps”, “tex” (pictex), “pdf”, “jpeg”, “tiff”, “png”, “bmp”, “svg” or “wmf”.</p>
<p>If you only provide the file name, R will save the last plot you created.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-visualisation.html#cb22-1"></a><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&quot;last_plot.jpeg&quot;</span>)</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<p>If you want to make sure you save a specific plot, you can save your plot to an object and then give that argument to <code>ggsave()</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-visualisation.html#cb24-1"></a>my_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat_filter, <span class="kw">aes</span>(<span class="dt">x =</span> start_port, <span class="dt">fill =</span> start_port)) <span class="op">+</span></span>
<span id="cb24-2"><a href="data-visualisation.html#cb24-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</span>
<span id="cb24-3"><a href="data-visualisation.html#cb24-3"></a></span>
<span id="cb24-4"><a href="data-visualisation.html#cb24-4"></a><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&quot;my_plot.jpeg&quot;</span>, <span class="dt">plot =</span> my_plot)</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
</div>
<div id="adding-more-variables" class="section level2">
<h2><span class="header-section-number">2.11</span> Adding more variables</h2>
<p>So far all the plots we have made have represented a maximum of two variables, however, often you will want to represent three or more variables (be they continuous or discrete) and there are two main ways that you can do this. The first way is to display data from all variables on the same plot broken down by groups.</p>
<p>First let’s make another standard scatterplot, this time looking at how many slaves died in each year.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-visualisation.html#cb26-1"></a><span class="kw">ggplot</span>(dat_filter, <span class="kw">aes</span>(arrival_year, died)) <span class="op">+</span></span>
<span id="cb26-2"><a href="data-visualisation.html#cb26-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb26-3"><a href="data-visualisation.html#cb26-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-23"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-23-1.png" alt="Two-variable scatterplot" width="100%" />
<p class="caption">
Figure 2.9: Two-variable scatterplot
</p>
</div>
<p>We can break this down by port of origin using <code>colour</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-visualisation.html#cb27-1"></a><span class="kw">ggplot</span>(dat_filter, <span class="kw">aes</span>(arrival_year, died, <span class="dt">colour =</span> start_port)) <span class="op">+</span></span>
<span id="cb27-2"><a href="data-visualisation.html#cb27-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb27-3"><a href="data-visualisation.html#cb27-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> start_port)) <span class="op">+</span></span>
<span id="cb27-4"><a href="data-visualisation.html#cb27-4"></a><span class="st">  </span><span class="kw">scale_colour_viridis_d</span>(<span class="dt">alpha =</span> <span class="fl">.8</span>, <span class="dt">option =</span> <span class="st">&quot;D&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-24"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-24-1.png" alt="Scatterplot grouped by colour" width="100%" />
<p class="caption">
Figure 2.10: Scatterplot grouped by colour
</p>
</div>
<p>This graph now shows the data points and line of best fit in a different colour for each port of origin. We can make this easier to read by adding a theme, editing the axis labels, and also adjusting the limits of the x-axis so that there is no wasted space.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-visualisation.html#cb28-1"></a><span class="kw">ggplot</span>(dat_filter, <span class="kw">aes</span>(arrival_year, died, <span class="dt">colour =</span> start_port)) <span class="op">+</span></span>
<span id="cb28-2"><a href="data-visualisation.html#cb28-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb28-3"><a href="data-visualisation.html#cb28-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb28-4"><a href="data-visualisation.html#cb28-4"></a><span class="st">  </span><span class="kw">scale_colour_viridis_d</span>(<span class="dt">alpha =</span> <span class="fl">.8</span>, <span class="dt">option =</span> <span class="st">&quot;D&quot;</span>) <span class="op">+</span></span>
<span id="cb28-5"><a href="data-visualisation.html#cb28-5"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb28-6"><a href="data-visualisation.html#cb28-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Year of arrival&quot;</span>,</span>
<span id="cb28-7"><a href="data-visualisation.html#cb28-7"></a>       <span class="dt">y =</span> <span class="st">&quot;Number of slaves who died&quot;</span>, </span>
<span id="cb28-8"><a href="data-visualisation.html#cb28-8"></a>       <span class="dt">colour =</span> <span class="st">&quot;Port of origin&quot;</span>) <span class="op">+</span></span>
<span id="cb28-9"><a href="data-visualisation.html#cb28-9"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1641</span>, <span class="dv">1815</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-25"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-25-1.png" alt="Grouped scatterplot with adjusted axes" width="100%" />
<p class="caption">
Figure 2.11: Grouped scatterplot with adjusted axes
</p>
</div>
<p>Alternatively, we can create three separate plots for each port using <code>facet_wrap()</code>.</p>
<p>The base code for this plot is similar to the above with the following changes:</p>
<ul>
<li><code>start_port</code> is removed from the first line of code specifying the aesthetic and instead is added just to <code>geom_point()</code> so that only the data points have different colours, not the line of best fit, to make it easier to read (try adding it back in to the first line and see what happens).</li>
<li>An extra layer of <code>facet_wrap()</code> is added that tells R to split the graphs for each level of <code>start_port</code>.</li>
<li><code>nrow</code> specifies the number of rows the plots should be split across. Try changing this number to 1.</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-visualisation.html#cb29-1"></a><span class="kw">ggplot</span>(dat_filter, <span class="kw">aes</span>(arrival_year, died)) <span class="op">+</span></span>
<span id="cb29-2"><a href="data-visualisation.html#cb29-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> start_port), <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb29-3"><a href="data-visualisation.html#cb29-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb29-4"><a href="data-visualisation.html#cb29-4"></a><span class="st">  </span><span class="kw">scale_colour_viridis_d</span>(<span class="dt">alpha =</span> <span class="fl">.8</span>, <span class="dt">option =</span> <span class="st">&quot;D&quot;</span>) <span class="op">+</span></span>
<span id="cb29-5"><a href="data-visualisation.html#cb29-5"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>start_port, <span class="dt">nrow =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb29-6"><a href="data-visualisation.html#cb29-6"></a><span class="st">  </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb29-7"><a href="data-visualisation.html#cb29-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Year of arrival&quot;</span>,</span>
<span id="cb29-8"><a href="data-visualisation.html#cb29-8"></a>       <span class="dt">y =</span> <span class="st">&quot;Number of slaves embarked&quot;</span>,</span>
<span id="cb29-9"><a href="data-visualisation.html#cb29-9"></a>       <span class="dt">title =</span> <span class="st">&quot;Slave deaths for ships with British ports of origin&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb29-10"><a href="data-visualisation.html#cb29-10"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1641</span>, <span class="dv">1815</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-26"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-26-1.png" alt="Facetted scatterplot" width="100%" />
<p class="caption">
Figure 2.12: Facetted scatterplot
</p>
</div>
</div>
<div id="reshaping-data" class="section level2">
<h2><span class="header-section-number">2.12</span> Reshaping data</h2>
<p>For our final plots, we need to reshape the data before we can use it. We want a plot that shows the proportion of men, women, and children on ships originating from the three British ports.</p>
<p>The function <code>pivot_longer()</code> is used to transform data from wide-form into long-form. If you’d like more detail on this, see <a href="https://psyteachr.github.io/msc-conv-odl/data-wrangling-3.html">Data Wrangling 3</a>.</p>
<p>When it comes to reshaping data it is easier to show than tell - run the below code then look at <code>dat_long</code> and see how the columns that used to contain the information about the proportion of women, men, and children on each ship have changed.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-visualisation.html#cb30-1"></a>dat_long &lt;-<span class="st"> </span>dat_filter <span class="op">%&gt;%</span></span>
<span id="cb30-2"><a href="data-visualisation.html#cb30-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">&quot;women&quot;</span>, <span class="st">&quot;men&quot;</span>, <span class="st">&quot;children&quot;</span>), </span>
<span id="cb30-3"><a href="data-visualisation.html#cb30-3"></a>               <span class="dt">names_to =</span> <span class="st">&quot;slave&quot;</span>, </span>
<span id="cb30-4"><a href="data-visualisation.html#cb30-4"></a>               <span class="dt">values_to =</span> <span class="st">&quot;prop&quot;</span>)</span></code></pre></div>
<p>We can now use the variable <code>slave</code> (woman, man, child) as a categorical variable and plot the average proportion of slaves who were men, women, and children combined with other variables.</p>
</div>
<div id="grouping-data-with-fill" class="section level2">
<h2><span class="header-section-number">2.13</span> Grouping data with <code>fill</code></h2>
<p>Above we displayed different colours of a scatterplot by specifying a continious variable to <code>colour</code>. We can do the same for categorical variables using <code>fill</code>. In the below plot we can represent the proportion of women, men, and children on ships originating from the three British ports, that is, we are representing one continuous variable (prop), and two categorical variables (port and type).</p>
<ul>
<li>Add the code that edits the axis labels. You should change the labels for x, y and fill, and also add a title.</li>
<li>Change the value of <code>alpha</code> and see what happens.</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="data-visualisation.html#cb31-1"></a><span class="kw">ggplot</span>(dat_long, <span class="kw">aes</span>(<span class="dt">x =</span> slave, <span class="dt">y =</span> prop, <span class="dt">fill =</span> start_port)) <span class="op">+</span></span>
<span id="cb31-2"><a href="data-visualisation.html#cb31-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">alpha =</span> <span class="fl">.5</span>) <span class="op">+</span></span>
<span id="cb31-3"><a href="data-visualisation.html#cb31-3"></a><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;E&quot;</span>) <span class="op">+</span></span>
<span id="cb31-4"><a href="data-visualisation.html#cb31-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-28"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-28-1.png" alt="Grouped boxplot" width="100%" />
<p class="caption">
Figure 2.13: Grouped boxplot
</p>
</div>
<p>Finally, we can combine <code>ggplot()</code> with <code>filter()</code> using a pipe to narrow down our dataset without creating a separate object.</p>
<ul>
<li>Use <code>fill</code> to give each boxplot a different colour.</li>
<li>Suppress the legend for <code>geom_boxplot()</code> because it’s not informative</li>
<li>Use the <code>viridis</code> palette</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="data-visualisation.html#cb32-1"></a>dat_long <span class="op">%&gt;%</span></span>
<span id="cb32-2"><a href="data-visualisation.html#cb32-2"></a><span class="st">  </span><span class="kw">filter</span>(outcome <span class="op">==</span><span class="st"> &quot;Slaves disembarked in Americas&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb32-3"><a href="data-visualisation.html#cb32-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> slave, <span class="dt">y =</span> prop)) <span class="op">+</span></span>
<span id="cb32-4"><a href="data-visualisation.html#cb32-4"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb32-5"><a href="data-visualisation.html#cb32-5"></a><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;E&quot;</span>) <span class="op">+</span></span>
<span id="cb32-6"><a href="data-visualisation.html#cb32-6"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb32-7"><a href="data-visualisation.html#cb32-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Proportion of women, men, and child slaves </span><span class="ch">\n</span><span class="st"> on ships disembarking in the Americas&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-29"></span>
<img src="01-tutorial_files/figure-html/unnamed-chunk-29-1.png" alt="Boxplot using filtered dataset" width="100%" />
<p class="caption">
Figure 2.14: Boxplot using filtered dataset
</p>
</div>

</div>
</div>



</div>
<div class="psyteachr_footer">
  
</div>
<script>

/* update total correct if #total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("correct").length + " of " +
      document.getElementsByClassName("solveme").length + " correct";
  }
}

/* solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "");
  }
  
  if (my_answer !== "" & real_answers.includes(my_answer)) {
    cl.add("correct");
  } else {
    cl.remove("correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol){
    var tol = JSON.parse(this.dataset.tol);  
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("correct");
    } else {
      cl.remove("correct");
    }  
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("correct");
    }  
  }
  
  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('solution')) {
      buttons[i].onclick = b_func;
    }
  }
  
  /* set up solveme inputs */
  var solveme = document.getElementsByClassName("solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off"); 
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";
    
    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;
    
    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"],
"google": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>
